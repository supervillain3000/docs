## Подключение порта к ВМ

Виртуальную машину можно подключить к сети с помощью порта. Порт — виртуальная сетевая карта ВМ, для которой настраиваются сущности:

- группа безопасности;
- подключенная сеть.

При [создании ВМ]() к ней подключается порт в подсети. Вы можете подключить к виртуальной машине дополнительный порт или отключить его. Это может быть порт из другой подсети или сети.

1. [Перейдите](https://console.ps.kz/) в консоль управления PS Cloud и выберите услугу **Облачные серверы**.
2. Выберите название проекта, который был зарегистрирован и выберите пункт **Серверы**.
3. Выберите виртуальную машину из списка.
4. Перейдите в раздел **Сеть**.
5. Нажмите кнопку **Добавить**.
6. В появившемся меню выберите значение из списка:
	- Создать: подробнее о создании порта в разделе [Управление портами]().
		- Выберите подсеть в которой требуется создать порт.
		- Нажмите кнопку **Создать**.
	- Выбрать существующий.
		- Выберите порт для подключения.
		- Нажмите кнопку **Применить**.
7. Подключенные порты появятся в списке. К ним можно применить действие удаления или отключения. 

---
#### CLI

Убедитесь что OpenStack CLI [установлен]() и пройдите [аутентификацию]() в проекте.
##### Подключение к существующему порту

1. Получите ID виртуальной машины, которой необходимо подключить порт:

```
openstack server list
```

2. Получите список сетей и подсетей:

```
openstack network list
```

3. Получите список доступных портов в нужой сети:

```
openstack port list --network <ID сети или имя>
```

4. Подключите необходимый доступный порт к ВМ:

```
openstack server add port <ID виртуальной машины> <ID порта>
```

5. Проверьте наличие порта у ВМ:

```
openstack port list --server <ID виртуальной машины или имя>
```

##### Создание нового порта

1. Получите список сетей и подсетей:

```
openstack network list
```

2. Получите список групп безопасности:
```
openstack security group list
```

3. Создайте порт:
- В нужной сети и с группой безопасности `default`:
```
openstack port create <имя порта> --network <имя или идентификатор сети>
```
- С указанием необходимых параметров:
```shell
  openstack port create <имя порта> \ 
  --network <ID сети или имя> \ 
  --fixed-ip subnet=<ID подсети или имя>,ip-address=<IP-адрес порта> \ 
  --security-group <ID группы безопасности>
```

Полный перечень доступных параметров можете посмотреть выполнив команду:

```
openstack port create --help
```

В результате создания будет выведен ID созданного порта и другая информация о нем.

5. Получите ID виртуальной машины, которой необходимо подключить порт:

```
openstack server list
```

6. Подключите созданный порт к ВМ:

```
openstack server add port <ID виртуальной машины> <ID порта>
```

7. Проверьте наличие порта у ВМ:

```
openstack port list --server <ID виртуальной машины или имя>
```

##### Удаление порта ВМ

1. Получите ID виртуальной машины:

```
openstack server list
```
2. Получите список подключенных портов к ВМ:
```
openstack port list --server <ID виртуальной машины или имя>
```
3. Удалите порт:
```
openstack port delete <ID порта>
```

---
### Terraform

```hcl
resource "openstack_networking_network_v2" "network_1" {
  name           = "network_1"
  admin_state_up = "true"
}

resource "openstack_compute_instance_v2" "instance_1" {
  name            = "instance_1"
  security_groups = ["default"]
}

resource "openstack_compute_interface_attach_v2" "ai_1" {
  instance_id = openstack_compute_instance_v2.instance_1.id
  network_id  = openstack_networking_port_v2.network_1.id
}
```