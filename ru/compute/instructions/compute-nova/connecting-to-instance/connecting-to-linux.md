

## Подключение к ВМ Linux


Удаленное подключение к ВМ на Linux происходит по протоколу SSH. Он основан на использовании логина и пароля пользователя или пары ключей: публичный и приватный ключ. Публичный ключ хранится на ВМ, а приватный у пользователя на локальном ПК. Подключение с помощью пары ключей более безопасно, чем подключение по логину и паролю.

При создании ВМ с помощью [консоли управления](https://console.ps.kz), вы можете выбрать удобный способ: создание пары ключей или отправка пароля для подключения на почту.  


### Создание пары ключей SSH

Создать пару SSH-ключей можно несколькими способами:

1. Создать пару на локальной машине, после чего импортировать публичный ключ при [создании]() ВМ.
2. Сгенерировать пару при создании ВМ, приватный ключ будет загружен на ваше устройство после генерации.
3. Заранее импортировать или сгенерировать пару в разделе **SSH-ключи**.

#### Linux:

1. Откройте терминал.
2. Создайте пару ключей с помощью команды `ssh-keygen`:

```
ssh-keygen -t ed25519
```

После выполнения команды вам будет предложено указать имена файлов, в которые будут сохранены ключи, и ввести пароль для закрытого ключа. Нажмите **Enter**, чтобы использовать предложенные командой имя и путь по умолчанию.

Пара ключей будет создана в текущей директории. Открытый ключ будет сохранен в файле с расширением `.pub`.

#### Windows 10:

Убедитесь что клиент [OpenSSH](https://learn.microsoft.com/ru-ru/windows-server/administration/openssh/openssh_install_firstuse) установлен на вашем ПК.

1. Запустите командную строку.
2. Создайте пару ключей с помощью команды `ssh-keygen`:

```
ssh-keygen -t ed25519
```

После выполнения команды вам будет предложено указать имена файлов, в которые будут сохранены ключи, и ввести пароль для закрытого ключа. Нажмите **Enter**, чтобы использовать предложенные командой имя и путь по умолчанию.

Пара ключей будет создана в текущей директории. Открытый ключ будет сохранен в файле с расширением `.pub`.

#### Windows 7/8

1. [Скачайте](https://www.putty.org/) и установите SSH-клиент PuTTY.
2. Запустите приложение PuTTYgen. Устанавливается в комплекте с PuTTY.
3. В качестве типа генерируемой пары выберите **EdDSA**. Нажмите **Generate**.
4. В поле **Key passphrase** введите надежный пароль. Повторно введите его в поле ниже.
5. Нажмите кнопку **Save private key** и сохраните закрытый ключ.
6. Сохраните ключ в текстовом файле. Для этого скопируйте открытый ключ **одной строкой** из текстового поля в текстовый файл с названием `id_ed25519.pub`.


### Импорт публичного ключа SSH

Для импорта публичного вам потребуется получить его содержимое:

#### Linux

1. Запустите терминал
2. Получите содержимое публичного ключа командой:

```
cat ~/.ssh/id_ed25519.pub
```
Имя ключа может отличаться. Используйте то имя, которое вы указали при создании. 

3. Скопируйте вывод содержимого публичного ключа в буфер обмена.
4. При [создании]() ВМ в шаге **Доступ** в пункте **SSH-ключ** нажмите кнопку **Добавить** и нажмите кнопку **Импортировать**
5. Вставьте полученное содержимое публичного ключа в поле **Публичный ключ** и нажмите кнопку **Импортировать**.
6. Данные шаги вы можете повторить в разделе **SSH-ключи**, для того чтобы заранее импортировать или сгенерировать пару SSH-ключей.

#### Windows

1. Запустите командную строку.
2. Выведите на экран содержимое файла:
```
type C:\Users\<имя_пользователя>\.ssh\<имя_ключа>.pub
```
3. Скопируйте содержимое в буфер обмена. 
4. При [создании]() ВМ в шаге **Доступ** в пункте **SSH-ключ** нажмите кнопку **Добавить** и нажмите кнопку **Импортировать**
5. Вставьте полученное содержимое публичного ключа в поле **Публичный ключ** и нажмите кнопку **Импортировать**.
6. Данные шаги вы можете повторить в разделе **SSH-ключи**, для того чтобы заранее импортировать или сгенерировать пару SSH-ключей.

### Подключение к ВМ 

Вы можете подключиться к ВМ в статусе `ACTIVE` по протоколу SSH.

Для подключения можно использовать утилиту `ssh` в Linux/macOS/Windows 10 и программу [PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/) для Windows 7/8.

Для подключения необходимо указать [плавающий IP-адрес]() ВМ. Плавающий IP-адрес можно узнать в консоли управления на странице ВМ в поле **IP-адреса**. Если ВМ была создана только с внутренней сетью, необходимо [привязать](instance-floating-ip-attach.md) к ней **плавающий IP-адрес**.

Можно также подключиться к ВМ по внутреннему IP-адресу с другой ВМ внутри одной [облачной подсети](). 

В [группах безопасности]() ВМ должно быть разрешающее на входящие подключения правило на порт 22.

Для подключения по SSH, необходимо:

#### Linux/Windows 10

1. Откройте терминал и выполните команду

```
ssh <имя_пользователя>@<плавающий_IP-адрес_ВМ>
```

Где: `<имя_пользователя>` это название дистрибутива выбранной операционной системы:

| Название дистрибутива ОС | Имя пользователя |
| ---- | ---- |
| Ubuntu | ubuntu |
| Centos | centos |
| Debian | debian |
| AlmaLinux | almalinux |
| Fedora | fedora |

2. Если при [создании ВМ]() вы выбрали пункт **Использовать пароль**, вам будет предложено ввести пароль.
3. Если у вас имеется несколько пар SSH-ключей, уточните нужный ключ командой:

```
ssh -i <путь_к_ключу/имя_файла_ключа> <имя_пользователя>@<плавающий_IP-адрес_ВМ>
```

4. При первом подключении к ВМ появится запрос подтверждения подключения к неизвестному ранее хосту:

```
The authenticity of host '91.XXX.93.95 (91.XXX.93.95)' can't be established. ECDSA key fingerprint is SHA256:xXXXXxX9N6KRtfFOuic6eoWcluhSp6+jha/DSBgd9McI. Are you sure you want to continue connecting (yes/no)?
```

Введите в терминале слово `yes` и нажмите **Enter**.







